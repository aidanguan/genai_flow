# Mermaid å›¾è¡¨é«˜çº§ç¼–è¾‘åŠŸèƒ½

## åŠŸèƒ½æ¦‚è§ˆ

æ ¹æ®åŸå‹é¡¹ç›®éœ€æ±‚å’Œ [mermaid-live-editor](https://github.com/mermaid-js/mermaid-live-editor) çš„å‚è€ƒ,å·²æˆåŠŸä¸º mermaid å›¾è¡¨å¢åŠ äº†å®Œæ•´çš„ç¼–è¾‘å’Œå¯¼å‡ºåŠŸèƒ½ã€‚

## æ–°å¢åŠŸèƒ½æ¸…å•

### 1. ä¸»é¢˜åˆ‡æ¢ (Theme Switching)
- **ä½ç½®**: ç”»å¸ƒé¡¶éƒ¨å·¥å…·æ ,è°ƒè‰²æ¿å›¾æ ‡
- **æ”¯æŒä¸»é¢˜**:
  - é»˜è®¤ (default)
  - æ·±è‰² (dark)
  - æ£®æ— (forest)
  - ä¸­æ€§ (neutral)
  - åŸºç¡€ (base)
- **ä½¿ç”¨æ–¹å¼**: ç‚¹å‡»ä¸»é¢˜æŒ‰é’®,é€‰æ‹©æ‰€éœ€ä¸»é¢˜,å›¾è¡¨å®æ—¶æ¸²æŸ“

### 2. æ–¹å‘åˆ‡æ¢ (Direction Control)
- **ä½ç½®**: ç”»å¸ƒé¡¶éƒ¨å·¥å…·æ ,ç®­å¤´å›¾æ ‡
- **æ”¯æŒæ–¹å‘**:
  - ä¸Šåˆ°ä¸‹ (TD/TB) - Top to Down
  - ä¸‹åˆ°ä¸Š (BT) - Bottom to Top
  - å·¦åˆ°å³ (LR) - Left to Right
  - å³åˆ°å·¦ (RL) - Right to Left
- **ä½¿ç”¨æ–¹å¼**: ç‚¹å‡»æ–¹å‘æŒ‰é’®,é€‰æ‹©æ–¹å‘,è‡ªåŠ¨ä¿®æ”¹ä»£ç å¹¶é‡æ–°æ¸²æŸ“

### 3. å¯¼å‡ºåŠŸèƒ½ (Export)
- **ä½ç½®**: ç”»å¸ƒé¡¶éƒ¨å·¥å…·æ ,ä¸‹è½½å›¾æ ‡
- **æ”¯æŒæ ¼å¼**:
  - **SVG**: çŸ¢é‡å›¾å½¢,æ— æŸè´¨é‡,ä½¿ç”¨ file-saver åº“ç›´æ¥ä¸‹è½½
  - **PNG**: ä½å›¾æ ¼å¼,ä½¿ç”¨ html2canvas åº“å°† SVG è½¬æ¢ä¸º PNG (2x é«˜æ¸…)
  - **PDF**: æ–‡æ¡£æ ¼å¼,ä½¿ç”¨ jsPDF åº“å°†å›¾è¡¨è½¬æ¢ä¸º PDF,è‡ªåŠ¨é€‚é…æ¨ªç«–ç‰ˆ
- **ä½¿ç”¨æ–¹å¼**: ç‚¹å‡»å¯¼å‡ºæŒ‰é’®,é€‰æ‹©æ ¼å¼,æµè§ˆå™¨è‡ªåŠ¨ä¸‹è½½

### 4. å›¾è¡¨ç¼–è¾‘åŠŸèƒ½ (Edit Features)
- **ä½ç½®**: ç”»å¸ƒé¡¶éƒ¨å·¥å…·æ ,åŠ å·å›¾æ ‡

#### 4.1 å¢åŠ èŠ‚ç‚¹ (Add Nodes)
æ”¯æŒä»¥ä¸‹å½¢çŠ¶:
- **çŸ©å½¢** `[æ–‡æœ¬]` - æ ‡å‡†èŠ‚ç‚¹
- **åœ†è§’çŸ©å½¢** `(æ–‡æœ¬)` - æµç¨‹å›¾æµç¨‹èŠ‚ç‚¹
- **åœ†å½¢** `((æ–‡æœ¬))` - å¼€å§‹/ç»“æŸèŠ‚ç‚¹
- **è±å½¢** `{æ–‡æœ¬}` - åˆ¤æ–­èŠ‚ç‚¹
- **å…­è¾¹å½¢** `{{æ–‡æœ¬}}` - ç‰¹æ®ŠèŠ‚ç‚¹

#### 4.2 å¢åŠ è¿çº¿ (Add Connections)
æ”¯æŒä»¥ä¸‹è¿çº¿æ ·å¼:
- **ç®­å¤´** `-->` - æ ‡å‡†æœ‰å‘è¿çº¿
- **ç›´çº¿** `---` - æ— å‘è¿çº¿
- **è™šçº¿** `.->` - è™šçº¿ç®­å¤´
- **ç²—ç®­å¤´** `==>` - ç²—å®çº¿ç®­å¤´

**æ™ºèƒ½è¿æ¥**: è‡ªåŠ¨è¿æ¥æœ€åä¸¤ä¸ªèŠ‚ç‚¹

## æŠ€æœ¯å®ç°

### å‰ç«¯ä¾èµ–
```json
{
  "html2canvas": "^1.4.1",  // PNG å¯¼å‡º
  "jspdf": "^2.5.2",        // PDF å¯¼å‡º
  "file-saver": "^2.0.5"    // æ–‡ä»¶ä¸‹è½½
}
```

### æ ¸å¿ƒç»„ä»¶
- **MermaidEditor.vue**: ä¸»ç¼–è¾‘å™¨ç»„ä»¶,åŒ…å«æ‰€æœ‰æ–°åŠŸèƒ½
  - ä¸»é¢˜ç®¡ç†: `currentTheme` reactive state
  - æ–¹å‘æ§åˆ¶: `updateDiagramDirection()` è‡ªåŠ¨ä¿®æ”¹ä»£ç 
  - å¯¼å‡ºé€»è¾‘: `downloadSVG/PNG/PDF()` ä¸‰ç§æ ¼å¼
  - èŠ‚ç‚¹ç¼–è¾‘: `addNode(shape)` åŠ¨æ€æ·»åŠ èŠ‚ç‚¹
  - è¿çº¿ç¼–è¾‘: `addConnection(style)` æ™ºèƒ½è¿æ¥èŠ‚ç‚¹

### åç«¯æ”¯æŒ
- **main.py**: æ–°å¢ `/api/export` æ¥å£
- **export_service.py**: SVG å¯¼å‡ºæœåŠ¡(PNG/PDF ç”±å‰ç«¯å¤„ç†)

## UI è®¾è®¡

### å·¥å…·æ å¸ƒå±€
```
[ ä¸»é¢˜ğŸ¨ ] [ æ–¹å‘â¡ï¸ ] [ å¯¼å‡ºâ¬‡ï¸ ] [ ç¼–è¾‘â• ]
```

- åœ†è§’è®¾è®¡,æ¯›ç»ç’ƒæ•ˆæœ (backdrop-blur)
- æ·±è‰²/æµ…è‰²ä¸»é¢˜è‡ªé€‚åº”
- ä¸‹æ‹‰èœå•å¼¹å‡ºå¼è®¾è®¡
- æ‰€æœ‰æ–‡æœ¬ä½¿ç”¨ä¸­æ–‡,ç¬¦åˆç”¨æˆ·è®°å¿†åå¥½

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: åˆ‡æ¢ä¸»é¢˜
1. ç‚¹å‡»å·¥å…·æ  "ä¸»é¢˜" æŒ‰é’®
2. é€‰æ‹© "æ£®æ—" ä¸»é¢˜
3. å›¾è¡¨ç«‹å³ä»¥ç»¿è‰²ç³»æ¸²æŸ“

### ç¤ºä¾‹ 2: æ”¹å˜æ–¹å‘
1. ç‚¹å‡»å·¥å…·æ  "æ–¹å‘" æŒ‰é’®
2. é€‰æ‹© "å·¦åˆ°å³"
3. ä»£ç è‡ªåŠ¨ä» `graph TD` æ›´æ–°ä¸º `graph LR`
4. å›¾è¡¨é‡æ–°æ¨ªå‘å¸ƒå±€

### ç¤ºä¾‹ 3: æ·»åŠ èŠ‚ç‚¹å’Œè¿çº¿
1. ç‚¹å‡» "ç¼–è¾‘" â†’ "å¢åŠ èŠ‚ç‚¹" â†’ "åœ†å½¢"
2. ä»£ç æ–°å¢: `Node1((åœ†å½¢))`
3. ç‚¹å‡» "ç¼–è¾‘" â†’ "å¢åŠ è¿çº¿" â†’ "è™šçº¿"
4. è‡ªåŠ¨è¿æ¥æœ€åä¸¤ä¸ªèŠ‚ç‚¹: `PrevNode -.-> Node1`

### ç¤ºä¾‹ 4: å¯¼å‡ºå›¾è¡¨
1. ç‚¹å‡» "å¯¼å‡º" æŒ‰é’®
2. é€‰æ‹© "PNG" æ ¼å¼
3. æµè§ˆå™¨è‡ªåŠ¨ä¸‹è½½ `mermaid-diagram.png` (2å€é«˜æ¸…)

## æµ‹è¯•éªŒè¯

ä½¿ç”¨ chrome-devtools å®Œæˆä»¥ä¸‹åŠŸèƒ½éªŒè¯:
- âœ… ä¸»é¢˜åˆ‡æ¢æ­£å¸¸,5ç§ä¸»é¢˜å…¨éƒ¨å¯ç”¨
- âœ… æ–¹å‘åˆ‡æ¢æˆåŠŸ,ä»£ç è‡ªåŠ¨æ›´æ–°
- âœ… å¯¼å‡ºèœå•æ­£å¸¸æ˜¾ç¤º SVG/PNG/PDF é€‰é¡¹
- âœ… èŠ‚ç‚¹æ·»åŠ åŠŸèƒ½æ­£å¸¸,5ç§å½¢çŠ¶å…¨éƒ¨å¯ç”¨
- âœ… è¿çº¿æ·»åŠ åŠŸèƒ½æ­£å¸¸,æ™ºèƒ½è¿æ¥æœ€åä¸¤ä¸ªèŠ‚ç‚¹
- âœ… UI ç¾è§‚,ä¸­æ–‡æ˜¾ç¤º,æ— æ»šåŠ¨æ¡

## æˆªå›¾
å‚è§ `screenshot_mermaid_features.png` æŸ¥çœ‹å®é™…æ•ˆæœã€‚

## å‚è€ƒèµ„æº
- [Mermaid Live Editor](https://github.com/mermaid-js/mermaid-live-editor)
- [Mermaid å®˜æ–¹æ–‡æ¡£](https://mermaid.js.org/)
- [html2canvas æ–‡æ¡£](https://html2canvas.hertzen.com/)
- [jsPDF æ–‡æ¡£](https://github.com/parallax/jsPDF)
